// Generated by CoffeeScript 1.10.0
(function() {
  var Iframe, IframeAdmin, IframeInfo, decorator, decoratorInfo, initIframePlugin, module;

  this.taigaContribPlugins = this.taigaContribPlugins || [];

  decorator = function($delegate, $templateCache, $route, $tgRepo) {
    var compile, directive;
    directive = $delegate[0];
    compile = directive.compile;
    directive.compile = function(tElement, tAttrs) {
      var link;
      link = compile.apply(this, arguments);
      tElement.append($templateCache.get('contrib/iframe-menu.html'));
      return function(scope, elem, attrs) {
        var projectId, promise;
        link.apply(this, arguments);
        projectId = 1;
        promise = $tgRepo.queryMany("iframe", {
          project: projectId
        });
        promise.then((function(_this) {
          return function(iframes) {
            scope.iframes = iframes;
          };
        })(this));
      };
    };
    return $delegate;
  };

  decoratorInfo = {
    type: "decorator",
    provider: "tgProjectMenuDirective",
    decorator: decorator
  };

  this.taigaContribPlugins.push(decoratorInfo);

  IframeInfo = {
    slug: "iframe",
    name: "Iframe",
    type: "admin",
    module: 'taigaContrib.iframe'
  };

  this.taigaContribPlugins.push(IframeInfo);

  IframeAdmin = (function() {
    IframeAdmin.$inject = ["$rootScope", "$scope", "$tgRepo", "tgAppMetaService", "$tgConfirm", "$tgHttp"];

    function IframeAdmin(rootScope, scope1, repo, appMetaService, confirm, http) {
      var scope;
      this.rootScope = rootScope;
      this.scope = scope1;
      this.repo = repo;
      this.appMetaService = appMetaService;
      this.confirm = confirm;
      this.http = http;
      this.scope.sectionName = "Iframe";
      this.scope.sectionSlug = "iframe";
      scope = this.scope;
      this.scope.$on("project:loaded", (function(_this) {
        return function() {
          var promise;
          promise = _this.repo.queryMany("iframe", {
            project: _this.scope.projectId
          });
          return promise.then(function(iframes) {
            console.log(iframes);
            scope.values = iframes;
          });
        };
      })(this));
    }

    return IframeAdmin;

  })();

  Iframe = (function() {
    Iframe.$inject = ["$rootScope", "$scope", "$tgRepo", "$route", "$sce"];

    function Iframe(rootScope, scope1, repo, route, $sce) {
      var promise, slug;
      this.rootScope = rootScope;
      this.scope = scope1;
      this.repo = repo;
      this.route = route;
      slug = this.route.current.params.islug;
      this.scope.trustSrc = function(src) {
        return $sce.trustAsResourceUrl(src);
      };
      this.scope.trustHtml = function(html) {
        return $sce.trustAsHtml(html);
      };
      promise = this.repo.queryOne("iframe", "by_slug", {
        project: 1,
        slug: this.route.current.params.islug
      });
      promise.then((function(_this) {
        return function(iframe) {
          console.log(iframe);
          return _this.scope.iframe = iframe;
        };
      })(this));
    }

    return Iframe;

  })();

  module = angular.module('taigaContrib.iframe', []);

  module.controller("ContribIframeAdminController", IframeAdmin);

  module.controller("ContribIframeController", Iframe);

  initIframePlugin = function($tgNavUrls, $tgUrls) {
    $tgNavUrls.update({
      "project-iframe": "/project/:project/iframe/:iframe"
    });
    $tgUrls.update({
      "iframe": "/iframe"
    });
  };

  module.run(["$tgNavUrls", "$tgUrls", initIframePlugin]);

  module.config(function($routeProvider) {
    return $routeProvider.when("/project/:pslug/iframe/:islug", {
      templateUrl: "contrib/iframe-show.html",
      loader: true,
      controller: "ContribIframeController",
      controllerAs: "vm"
    });
  });

  module.run([
    '$templateCache', function($templateCache) {
      return $templateCache.put('contrib/iframe', '<div ng-controller="ContribIframeAdminController as ctrl"><header><h1><span class="project-name">{{::project.name}}</span><span class="green">{{::sectionName}} </span></h1></header><section class="project-iframe-admin"><div tg-project-values="tg-project-values" type="userstory-statuses" ng-controller="ProjectValuesController as ctrl" ng-init="section=\'admin\'; resource=\'iframe\'; type=\'userstory-statuses\'; sectionName=\'ADMIN.PROJECT_VALUES_STATUS.US_TITLE\'" objName="status" class="admin-attributes-section"><div class="project-values-title"><h2>Iframes</h2><a href="" title="Add Iframe" class="button button-gray show-add-new"><span>Add Iframe</span></a></div><div class="colors-table"><div class="table-header"><div class="row"><div style="flex-basis: 60px; flex-grow: 0; max-width: 100px; position: relative" class="iframe-icon">Icon</div><div style="flex-basis: 60px; flex-grow: 1; position: relative" class="iframe-title">Title</div><div style="flex-basis: 60px; flex-grow: 1;  position: relative" class="iframe-slug">Slug</div><div style="padding-left: 20px; flex-basis: 120px; flex-grow: 3; position: relative" class="iframe-url">URL</div><div style="padding-left: 45px; flex-basis: 250px; flex-grow: 6; position: relative" class="iframe-html">HTML</div><div class="options-column"></div></div></div><div class="table-main"><div class="sortable ui-sortable"><div ng-repeat="i in values" tg-bind-scope="tg-bind-scope" class="tg-scope"><form tg-bind-scope="tg-bind-scope" style="max-width:100%"><div class="row table-main visualization"><span class="icon icon-drag-v"></span><div style="flex-basis: 60px; flex-grow: 0; max-width:100px; position: relative" class="iframe-icon"><span class="icon"><img ng-src="{{i.icon}}"/></span></div><div style="flex-basis: 60px; flex-grow: 1; position: relative" class="iframe-title"><span>{{ i.title }}</span></div><div style="flex-basis: 60px; flex-grow: 1; position: relative" class="iframe-slug"><span>{{ i.slug }}</span></div><div style="flex-basis: 120px; flex-grow: 3; position: relative" class="iframe-url"><span>{{ i.url }}</span></div><div style="flex-basis: 250px; flex-grow: 6; position: relative" class="iframe-html"><span>{{ i.html }}</span></div><div class="options-column"><a href="" title="{{\'ADMIN.COMMON.TITLE_ACTION_EDIT_VALUE\' | translate}}" class="a edit-value icon icon-edit"></a><a href="" title="{{\'ADMIN.COMMON.TITLE_ACTION_DELETE_VALUE\' | translate}}" class="delete-value icon icon-delete"></a></div></div><div class="row table-main edition hidden"><div class="iframe-icon"><span>FIXME</span></div><div class="iframe-title"><input name="title" type="text" placeholder="Title" ng-model="iframe.title" data-required="true" data-maxlength="255"/></div><div class="iframe-slug"><input name="slug" type="text" placeholder="Slug" ng-model="iframe.slug" data-required="true" data-maxlength="255"/></div><div class="iframe-url"><input name="url" type="text" placeholder="http://URL" ng-model="iframe.url" data-required="true" data-maxlength="255"/></div><div class="iframe-html"><span>FIXME</span></div><div class="options-column"><a href="" title="{{\'COMMON.SAVE\' | translate}}" class="save icon icon-floppy"></a><a href="" title="{{\'COMMON.CANCEL\' | translate}}" class="cancel icon icon-delete"></a></div></div></form></div></div></div></div></div></section></div>');
    }
  ]);

  module.run([
    '$templateCache', function($templateCache) {
      return $templateCache.put('contrib/iframe-menu.html', '<nav ng-if="vm.project" class="menu"><div class="menu-container"><ul class="main-nav"><li ng-repeat="i in iframes" id="{{i.slug}}"><a tg-nav="project-iframe:project=vm.project.get(\'slug\'),iframe=i.slug" ng-class="{active: vm.active == \'iframe\'}" title="{{i.title}}"><span class="icon"><img ng-src="{{i.icon}}"/></span><span class="helper">{{i.title}}</span></a></li></ul></div></nav>');
    }
  ]);

  module.run([
    '$templateCache', function($templateCache) {
      return $templateCache.put('contrib/iframe-show.html', '<div class="wrapper"><tg-project-menu></tg-project-menu><section class="main iframe"><h1> <a href="{{iframe.url}}">{{iframe.title}}</a></h1><div ng-show="iframe.html" ng-bind-html="trustHtml(iframe.html)" class="extra_html"></div><iframe src="{{trustSrc(iframe.url)}}" name="{{iframe.slug}}" style="width:100%; min-height:calc(100vh - 40px);"></iframe></section></div>');
    }
  ]);

}).call(this);
